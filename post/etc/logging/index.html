<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Golang Logrus Hook을 이용한 mutisink 로깅 | Devlog</title><meta name=keywords content="golang"><meta name=description content="Logrus? golang에서 사용하는 대표적인 logging 패키지인 logrus는 stdout, stderr등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.
구조화된(structured) 로깅? 로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.
기본 사용법 간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다
package main import ( &#34;os&#34; &#34;time&#34; log &#34;github.com/sirupsen/logrus&#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&#34;Info message&#34;) log."><meta name=author content="ralpioxxcs"><link rel=canonical href=https://ralpioxxcs.github.io/post/etc/logging/><link crossorigin=anonymous href=/assets/css/stylesheet.3b9f476f1ea36ffba82578fc22bf4f0d29acf30b8cecc3387b6496b49caf0aac.css integrity="sha256-O59Hbx6jb/uoJXj8Ir9PDSms8wuM7MM4e2SWtJyvCqw=" rel="preload stylesheet" as=style><link rel=icon href=https://ralpioxxcs.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://ralpioxxcs.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://ralpioxxcs.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://ralpioxxcs.github.io/apple-touch-icon.png><link rel=mask-icon href=https://ralpioxxcs.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/prism-themes/prism.css><link rel=stylesheet href=/prism-themes/prism-nord.css><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-189380926-2","auto"),ga("send","pageview"))</script><meta property="og:title" content="Golang Logrus Hook을 이용한 mutisink 로깅"><meta property="og:description" content="Logrus? golang에서 사용하는 대표적인 logging 패키지인 logrus는 stdout, stderr등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.
구조화된(structured) 로깅? 로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.
기본 사용법 간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다
package main import ( &#34;os&#34; &#34;time&#34; log &#34;github.com/sirupsen/logrus&#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&#34;Info message&#34;) log."><meta property="og:type" content="article"><meta property="og:url" content="https://ralpioxxcs.github.io/post/etc/logging/"><meta property="article:section" content="post"><meta property="article:published_time" content="2022-06-07T22:36:04+09:00"><meta property="article:modified_time" content="2022-06-07T22:36:04+09:00"><meta property="og:site_name" content="Devlog"><meta name=twitter:card content="summary"><meta name=twitter:title content="Golang Logrus Hook을 이용한 mutisink 로깅"><meta name=twitter:description content="Logrus? golang에서 사용하는 대표적인 logging 패키지인 logrus는 stdout, stderr등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.
구조화된(structured) 로깅? 로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.
기본 사용법 간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다
package main import ( &#34;os&#34; &#34;time&#34; log &#34;github.com/sirupsen/logrus&#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&#34;Info message&#34;) log."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Post","item":"https://ralpioxxcs.github.io/post/"},{"@type":"ListItem","position":2,"name":"Golang Logrus Hook을 이용한 mutisink 로깅","item":"https://ralpioxxcs.github.io/post/etc/logging/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Golang Logrus Hook을 이용한 mutisink 로깅","name":"Golang Logrus Hook을 이용한 mutisink 로깅","description":"Logrus? golang에서 사용하는 대표적인 logging 패키지인 logrus는 stdout, stderr등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.\n구조화된(structured) 로깅? 로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.\n기본 사용법 간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다\npackage main import ( \u0026#34;os\u0026#34; \u0026#34;time\u0026#34; log \u0026#34;github.com/sirupsen/logrus\u0026#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(\u0026amp;log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(\u0026#34;Info message\u0026#34;) log.","keywords":["golang"],"articleBody":"Logrus? golang에서 사용하는 대표적인 logging 패키지인 logrus는 stdout, stderr등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.\n구조화된(structured) 로깅? 로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.\n기본 사용법 간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다\npackage main import ( \"os\" \"time\" log \"github.com/sirupsen/logrus\" ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(\u0026log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(\"Info message\") log.WithFields(log.Fields{ \"name\": \"Neymar\", \"age\": 32, \"club\": \"PSG\", }).Info(\"Info message with fields\") log.Debug(\"Debug message\") log.SetLevel(log.DebugLevel) log.Info(\"Info message\") log.Debug(\"Debug message\") } INFO[07 Jun 22 23:08 KST] Info message INFO[07 Jun 22 23:54 KST] Info message with fields age=32 club=PSG name=Neymar INFO[07 Jun 22 23:08 KST] Info message DEBU[07 Jun 22 23:08 KST] Debug message 이외에 다양한 사용방법에 대해서는 logrus 공식레포에서 확인하도록 하자\nMultisink 로깅 개발을 하다보면 단순히 콘솔창뿐만 아니라 파일에 로그를 남겨야 할 경우가 있다. 당연하게도 logrus 패키지에서는 io.Writer를 파라미터로 받는 logrus.SetOutput를 사용하여 콘솔, 파일 둘 다 동시에 로깅을 할 수 있다.\nfile, err := os.OpenFile(\"test.log\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0755) if err != nil { panic(err) } log.SetOutput(io.MultiWriter(os.Stdout, file)) 위 코드를 실행하게 되면 아래와 같은 출력과 로그파일을 볼수있다.\ntime=\"07 Jun 22 23:21 KST\" level=info msg=\"Info message\" time=\"07 Jun 22 23:21 KST\" level=info msg=\"Info message\" time=\"07 Jun 22 23:21 KST\" level=debug msg=\"Debug message\" 로깅 형식이 바뀐 이유 단순히 output을 바꿔주기만 했을뿐인데 로깅 포맷이 바뀌었다. 그 이유가 너무 궁금해서 패키지 내부 코드를 살펴보았다\nfunc (entry *Entry) write() { serialized, err := entry.Logger.Formatter.Format(entry) if err != nil { fmt.Fprintf(os.Stderr, \"Failed to obtain reader, %v\\n\", err) return } entry.Logger.mu.Lock() defer entry.Logger.mu.Unlock() if _, err := entry.Logger.Out.Write(serialized); err != nil { fmt.Fprintf(os.Stderr, \"Failed to write to log, %v\\n\", err) } } logrus 내부에서 실질적으로 로깅을 하는 부분을 봤더니 formatting된 byte slice를 받아서 logger에 등록된 io.Writer을 통해 write를 하는부분을 볼수 있었다.\nf.terminalInitOnce.Do(func() { f.init(entry) }) timestampFormat := f.TimestampFormat if timestampFormat == \"\" { timestampFormat = defaultTimestampFormat } if f.isColored() { f.printColored(b, entry, keys, data, timestampFormat) } else { // ... 출력 형식이 바뀐 이유가 된 핵심 부분이다. logrus내부에서 각 formatter에 맞게 형식을 변환시키는데 기본 TextFormatter의 경우, isTerminal이라는 변수로 터미널 여부를 판단한다. f.isColored 의 조건에 맞으면 원했던 로깅 포맷을 출력하게 되어있다.\nisColored := f.ForceColors || (f.isTerminal \u0026\u0026 (runtime.GOOS != \"windows\")) isColored의 조건은 위와 같다. 따라서 Formatter의 옵션중 하나인 ForceColors를 true로 설정해주면 이 문제는 해결된다.\n아래에서 서술할 내용이지만, 터미널 출력이 아닐경우 color code값이 로그파일에 남게되어 지저분해지니까 위와 같은 처리를 한 것같다.\nForceColor 옵션의 문제점 \u001b[36mINFO\u001b[0m[08 Jun 22 00:35 KST] Info message \u001b[36mINFO\u001b[0m[08 Jun 22 00:35 KST] Info message with fields \u001b[36mage\u001b[0m=32 \u001b[36mclub\u001b[0m=PSG \u001b[36mname\u001b[0m=Neymar \u001b[36mINFO\u001b[0m[08 Jun 22 00:35 KST] Info message \u001b[37mDEBU\u001b[0m[08 Jun 22 00:35 KST] Debug message ForceColors옵션을 주어 강제로 색상을 주고 로그파일을 보면 위와같이 콘솔에서 색상을 출력해주기위한 color code값이 그대로 적혀있다.\n로깅 자체에는 문제가 없지만 파일을 열어서 봤을때 보기도 힘들고 아무래도 뭔가 찝찝하다… 그렇다고 DisableColors값을 false로 주어 위 color code값을 없애자니 콘솔창에서 색상 highlight가 되지 않는다.\n사실 로그파일을 읽을때 grep 으로 level keyword를 highlight를 하는 등의 특정 키워드를 highlight하는 방법은 여러가지가 있다.\n그래도 이렇게 마무리하면 아쉬울 것 같아서\n같은 로깅 포맷을 사용 콘솔에서는 highlight를 그대로 사용 파일 로깅시에는 color code값을 제거 위를 모두 만족하는 방법은 없을까 해서 열심히 구글링을 해보다가. 비슷한 문제로 issue가 올라온걸 보았다.\n답변을 요약하면 SetOutput(os.Stdout)은 그대로 적용해 coloring을 하고, 별도의 formatter를 갖는 Hook을 추가하는 방법으로 문제를 해결하는 방법을 말하고 있다.\nFile Hooking logrus는 hook기능을 제공하는데 hook을 이용해 지정된 곳에 한번에 로그를 남길 수 있다.\n우선 color code가 없는 형태의 custom formatter 인터페이스를 구현한다\ntype PlainFormatter struct { log.TextFormatter TimestampFormat string LevelDesc []string } func NewPlainFormatter() *PlainFormatter { return \u0026PlainFormatter{ TimestampFormat: time.RFC3339, LevelDesc: []string{\"PANC\", \"FATL\", \"ERRO\", \"WARN\", \"INFO\", \"DEBG\"}, } } func (f *PlainFormatter) Format(entry *log.Entry) ([]byte, error) { timestamp := fmt.Sprintf(\"%v\", entry.Time.Format(f.TimestampFormat)) return []byte(fmt.Sprintf(\"[%s] [%s] %s\\n\", f.LevelDesc[entry.Level], timestamp, entry.Message)), nil } 다음으로 file을 생성하는 Hook 인터페이스를 구현한다\ntype FileHook struct { Formatter logrus.Formatter Level []logrus.Level Writer io.Writer } func NewFileHook() log.Hook { file, err := os.OpenFile(\"test.log\", os.O_CREATE|os.O_WRONLY|os.O_APPEND, 0755) if err != nil { panic(err) } return \u0026FileHook{ Formatter: NewPlainFormatter(), Level: []log.Level{ log.InfoLevel, }, Writer: file, } } func (h *FileHook) Fire(entry *log.Entry) error { bytes, err := h.Formatter.Format(entry) if err != nil { return err } h.Writer.Write(bytes) return nil } func (h *FileHook) Levels() []logrus.Level { return h.Level } 중요한 부분은 FileHook 구조체에 별도의 Formatter와 Writer를 설정하는것이다.\nbuilt-in formatter인 TextFormatter를 사용하지 않는 이유는 color code값을 제거하기 위해서다.\n위 설정을 모두 추가한 후, 실제 사용부분에서 log.AddHook(NewFileHook) 만 추가해주면 완성이다.\n실제 쓰여진 파일로그를 보면, WithFields를 사용한 로그는 적용되지 않는데, 그 부분은 PlainFormatter의 interface method인 Format()에서 별도로 처리해야 한다.\nReference https://github.com/sirupsen/logrus/issues/784 ","wordCount":"730","inLanguage":"en","datePublished":"2022-06-07T22:36:04+09:00","dateModified":"2022-06-07T22:36:04+09:00","author":{"@type":"Person","name":"ralpioxxcs"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://ralpioxxcs.github.io/post/etc/logging/"},"publisher":{"@type":"Organization","name":"Devlog","logo":{"@type":"ImageObject","url":"https://ralpioxxcs.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://ralpioxxcs.github.io/ accesskey=h title="Devlog (Alt + H)"><img src=https://ralpioxxcs.github.io/apple-touch-icon.png alt=logo aria-label=logo height=22>Devlog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://ralpioxxcs.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=https://ralpioxxcs.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://ralpioxxcs.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://ralpioxxcs.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://ralpioxxcs.github.io/post/>Post</a></div><h1 class=post-title>Golang Logrus Hook을 이용한 mutisink 로깅</h1><div class=post-meta><span title='2022-06-07 22:36:04 +0900 KST'>June 7, 2022</span>&nbsp;·&nbsp;4 min&nbsp;·&nbsp;730 words&nbsp;·&nbsp;ralpioxxcs&nbsp;|&nbsp;<a href=https://github.com/ralpioxxcs/blog/blob/master/content/post/etc/logging.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#logrus>Logrus?</a><ul><li><a href=#구조화된structured-로깅>구조화된(structured) 로깅?</a></li></ul></li><li><a href=#기본-사용법>기본 사용법</a></li><li><a href=#multisink-로깅>Multisink 로깅</a><ul><li><a href=#로깅-형식이-바뀐-이유>로깅 형식이 바뀐 이유</a></li><li><a href=#forcecolor-옵션의-문제점>ForceColor 옵션의 문제점</a></li></ul></li><li><a href=#file-hooking>File Hooking</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><h2 id=logrus>Logrus?<a hidden class=anchor aria-hidden=true href=#logrus>#</a></h2><p>golang에서 사용하는 대표적인 logging 패키지인 <a href=https://github.com/sirupsen/logrus>logrus</a>는 <code>stdout</code>, <code>stderr</code>등 다양한 output 및 커스터마이징이 가능한 formatter등 구조화된 로깅을 지원한다.</p><h3 id=구조화된structured-로깅>구조화된(structured) 로깅?<a hidden class=anchor aria-hidden=true href=#구조화된structured-로깅>#</a></h3><p>로그를 단순한 텍스트의 연속이 아닌 특정 데이터 세트(날짜, 사용자, 각종 필드)로 처리할 수 있도록 특정한 메시지 포맷을 구현하는 방식이다.</p><h2 id=기본-사용법>기본 사용법<a hidden class=anchor aria-hidden=true href=#기본-사용법>#</a></h2><p>간단하게 콘솔창에 로그를 찍는 예제는 다음과 같다</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kn>package</span> <span class=nx>main</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;os&#34;</span>
</span></span><span class=line><span class=cl>	<span class=s>&#34;time&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span> <span class=s>&#34;github.com/sirupsen/logrus&#34;</span>
</span></span><span class=line><span class=cl><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>SetOutput</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>SetFormatter</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>log</span><span class=p>.</span><span class=nx>TextFormatter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>FullTimestamp</span><span class=p>:</span>   <span class=kc>true</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>TimestampFormat</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nx>RFC822</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>SetLevel</span><span class=p>(</span><span class=nx>log</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Info message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>WithFields</span><span class=p>(</span><span class=nx>log</span><span class=p>.</span><span class=nx>Fields</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;name&#34;</span><span class=p>:</span> <span class=s>&#34;Neymar&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;age&#34;</span><span class=p>:</span>  <span class=mi>32</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=s>&#34;club&#34;</span><span class=p>:</span> <span class=s>&#34;PSG&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}).</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Info message with fields&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Debug</span><span class=p>(</span><span class=s>&#34;Debug message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>SetLevel</span><span class=p>(</span><span class=nx>log</span><span class=p>.</span><span class=nx>DebugLevel</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Info</span><span class=p>(</span><span class=s>&#34;Info message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nf>Debug</span><span class=p>(</span><span class=s>&#34;Debug message&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>INFO<span class=o>[</span><span class=m>07</span> Jun <span class=m>22</span> 23:08 KST<span class=o>]</span> Info message     
</span></span><span class=line><span class=cl>INFO<span class=o>[</span><span class=m>07</span> Jun <span class=m>22</span> 23:54 KST<span class=o>]</span> Info message with fields                      <span class=nv>age</span><span class=o>=</span><span class=m>32</span> <span class=nv>club</span><span class=o>=</span>PSG <span class=nv>name</span><span class=o>=</span>Neymar                            
</span></span><span class=line><span class=cl>INFO<span class=o>[</span><span class=m>07</span> Jun <span class=m>22</span> 23:08 KST<span class=o>]</span> Info message                                 
</span></span><span class=line><span class=cl>DEBU<span class=o>[</span><span class=m>07</span> Jun <span class=m>22</span> 23:08 KST<span class=o>]</span> Debug message  
</span></span></code></pre></div><p>이외에 다양한 사용방법에 대해서는 logrus <a href=https://github.com/sirupsen/logrus>공식레포</a>에서 확인하도록 하자</p><hr><h2 id=multisink-로깅>Multisink 로깅<a hidden class=anchor aria-hidden=true href=#multisink-로깅>#</a></h2><p>개발을 하다보면 단순히 콘솔창뿐만 아니라 파일에 로그를 남겨야 할 경우가 있다. 당연하게도 logrus 패키지에서는 <code>io.Writer</code>를 파라미터로 받는 <code>logrus.SetOutput</code>를 사용하여 콘솔, 파일 둘 다 동시에 로깅을 할 수 있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>OpenFile</span><span class=p>(</span><span class=s>&#34;test.log&#34;</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nx>O_CREATE</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_WRONLY</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_APPEND</span><span class=p>,</span> <span class=mo>0755</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nx>log</span><span class=p>.</span><span class=nf>SetOutput</span><span class=p>(</span><span class=nx>io</span><span class=p>.</span><span class=nf>MultiWriter</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stdout</span><span class=p>,</span> <span class=nx>file</span><span class=p>))</span>
</span></span></code></pre></div><p>위 코드를 실행하게 되면 아래와 같은 출력과 로그파일을 볼수있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;07 Jun 22 23:21 KST&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Info message&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;07 Jun 22 23:21 KST&#34;</span> <span class=nv>level</span><span class=o>=</span>info <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Info message&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>time</span><span class=o>=</span><span class=s2>&#34;07 Jun 22 23:21 KST&#34;</span> <span class=nv>level</span><span class=o>=</span>debug <span class=nv>msg</span><span class=o>=</span><span class=s2>&#34;Debug message&#34;</span>
</span></span></code></pre></div><h3 id=로깅-형식이-바뀐-이유>로깅 형식이 바뀐 이유<a hidden class=anchor aria-hidden=true href=#로깅-형식이-바뀐-이유>#</a></h3><p>단순히 output을 바꿔주기만 했을뿐인데 로깅 포맷이 바뀌었다. 그 이유가 너무 궁금해서 패키지 내부 코드를 살펴보았다</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>entry</span> <span class=o>*</span><span class=nx>Entry</span><span class=p>)</span> <span class=nf>write</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>serialized</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>Formatter</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=nx>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>,</span> <span class=s>&#34;Failed to obtain reader, %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>entry</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Lock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>mu</span><span class=p>.</span><span class=nf>Unlock</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Logger</span><span class=p>.</span><span class=nx>Out</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>serialized</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>fmt</span><span class=p>.</span><span class=nf>Fprintf</span><span class=p>(</span><span class=nx>os</span><span class=p>.</span><span class=nx>Stderr</span><span class=p>,</span> <span class=s>&#34;Failed to write to log, %v\n&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>logrus 내부에서 실질적으로 로깅을 하는 부분을 봤더니 formatting된 byte slice를 받아서 logger에 등록된 <code>io.Writer</code>을 통해 <code>write</code>를 하는부분을 볼수 있었다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl>	<span class=nx>f</span><span class=p>.</span><span class=nx>terminalInitOnce</span><span class=p>.</span><span class=nf>Do</span><span class=p>(</span><span class=kd>func</span><span class=p>()</span> <span class=p>{</span> <span class=nx>f</span><span class=p>.</span><span class=nf>init</span><span class=p>(</span><span class=nx>entry</span><span class=p>)</span> <span class=p>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>timestampFormat</span> <span class=o>:=</span> <span class=nx>f</span><span class=p>.</span><span class=nx>TimestampFormat</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>timestampFormat</span> <span class=o>==</span> <span class=s>&#34;&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>timestampFormat</span> <span class=p>=</span> <span class=nx>defaultTimestampFormat</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>f</span><span class=p>.</span><span class=nf>isColored</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>f</span><span class=p>.</span><span class=nf>printColored</span><span class=p>(</span><span class=nx>b</span><span class=p>,</span> <span class=nx>entry</span><span class=p>,</span> <span class=nx>keys</span><span class=p>,</span> <span class=nx>data</span><span class=p>,</span> <span class=nx>timestampFormat</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ...
</span></span></span></code></pre></div><p>출력 형식이 바뀐 이유가 된 핵심 부분이다. logrus내부에서 각 formatter에 맞게 형식을 변환시키는데 기본 TextFormatter의 경우, <code>isTerminal</code>이라는 변수로 터미널 여부를 판단한다. <code>f.isColored</code> 의 조건에 맞으면 원했던 로깅 포맷을 출력하게 되어있다.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>isColored</span> <span class=o>:=</span> <span class=nx>f</span><span class=p>.</span><span class=nx>ForceColors</span> <span class=o>||</span> <span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nx>isTerminal</span> <span class=o>&amp;&amp;</span> <span class=p>(</span><span class=nx>runtime</span><span class=p>.</span><span class=nx>GOOS</span> <span class=o>!=</span> <span class=s>&#34;windows&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p><code>isColored</code>의 조건은 위와 같다. 따라서 Formatter의 옵션중 하나인 <code>ForceColors</code>를 true로 설정해주면 이 문제는 해결된다.</p><p>아래에서 서술할 내용이지만, 터미널 출력이 아닐경우 color code값이 로그파일에 남게되어 지저분해지니까 위와 같은 처리를 한 것같다.</p><h3 id=forcecolor-옵션의-문제점>ForceColor 옵션의 문제점<a hidden class=anchor aria-hidden=true href=#forcecolor-옵션의-문제점>#</a></h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>[</span>36mINFO<span class=o>[</span>0m<span class=o>[</span><span class=m>08</span> Jun <span class=m>22</span> 00:35 KST<span class=o>]</span> Info message                                 
</span></span><span class=line><span class=cl><span class=o>[</span>36mINFO<span class=o>[</span>0m<span class=o>[</span><span class=m>08</span> Jun <span class=m>22</span> 00:35 KST<span class=o>]</span> Info message with fields                      <span class=o>[</span>36mage<span class=o>[</span><span class=nv>0m</span><span class=o>=</span><span class=m>32</span> <span class=o>[</span>36mclub<span class=o>[</span><span class=nv>0m</span><span class=o>=</span>PSG <span class=o>[</span>36mname<span class=o>[</span><span class=nv>0m</span><span class=o>=</span>Neymar
</span></span><span class=line><span class=cl><span class=o>[</span>36mINFO<span class=o>[</span>0m<span class=o>[</span><span class=m>08</span> Jun <span class=m>22</span> 00:35 KST<span class=o>]</span> Info message                                 
</span></span><span class=line><span class=cl><span class=o>[</span>37mDEBU<span class=o>[</span>0m<span class=o>[</span><span class=m>08</span> Jun <span class=m>22</span> 00:35 KST<span class=o>]</span> Debug message                                
</span></span></code></pre></div><p><code>ForceColors</code>옵션을 주어 강제로 색상을 주고 로그파일을 보면 위와같이 콘솔에서 색상을 출력해주기위한 color code값이 그대로 적혀있다.</p><p>로깅 자체에는 문제가 없지만 파일을 열어서 봤을때 보기도 힘들고 아무래도 뭔가 찝찝하다&mldr; 그렇다고 <code>DisableColors</code>값을 <strong>false</strong>로 주어 위 color code값을 없애자니 콘솔창에서 색상 highlight가 되지 않는다.</p><p>사실 로그파일을 읽을때 <code>grep</code> 으로 level keyword를 highlight를 하는 등의 특정 키워드를 <strong>highlight</strong>하는 방법은 여러가지가 있다.</p><p>그래도 이렇게 마무리하면 아쉬울 것 같아서</p><ul><li>같은 로깅 포맷을 사용</li><li>콘솔에서는 highlight를 그대로 사용</li><li>파일 로깅시에는 color code값을 제거</li></ul><p>위를 모두 만족하는 방법은 없을까 해서 열심히 구글링을 해보다가. 비슷한 문제로 <a href=https://github.com/sirupsen/logrus/issues/784>issue</a>가 올라온걸 보았다.</p><p>답변을 요약하면 <code>SetOutput(os.Stdout)</code>은 그대로 적용해 coloring을 하고, 별도의 formatter를 갖는 Hook을 추가하는 방법으로 문제를 해결하는 방법을 말하고 있다.</p><h2 id=file-hooking>File Hooking<a hidden class=anchor aria-hidden=true href=#file-hooking>#</a></h2><p>logrus는 <a href=https://github.com/sirupsen/logrus#hooks><code>hook</code></a>기능을 제공하는데 hook을 이용해 지정된 곳에 한번에 로그를 남길 수 있다.</p><p>우선 color code가 없는 형태의 custom formatter 인터페이스를 구현한다</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>PlainFormatter</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>log</span><span class=p>.</span><span class=nx>TextFormatter</span>
</span></span><span class=line><span class=cl>	<span class=nx>TimestampFormat</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>	<span class=nx>LevelDesc</span>       <span class=p>[]</span><span class=kt>string</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewPlainFormatter</span><span class=p>()</span> <span class=o>*</span><span class=nx>PlainFormatter</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>PlainFormatter</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>TimestampFormat</span><span class=p>:</span> <span class=nx>time</span><span class=p>.</span><span class=nx>RFC3339</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>LevelDesc</span><span class=p>:</span>       <span class=p>[]</span><span class=kt>string</span><span class=p>{</span><span class=s>&#34;PANC&#34;</span><span class=p>,</span> <span class=s>&#34;FATL&#34;</span><span class=p>,</span> <span class=s>&#34;ERRO&#34;</span><span class=p>,</span> <span class=s>&#34;WARN&#34;</span><span class=p>,</span> <span class=s>&#34;INFO&#34;</span><span class=p>,</span> <span class=s>&#34;DEBG&#34;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>f</span> <span class=o>*</span><span class=nx>PlainFormatter</span><span class=p>)</span> <span class=nf>Format</span><span class=p>(</span><span class=nx>entry</span> <span class=o>*</span><span class=nx>log</span><span class=p>.</span><span class=nx>Entry</span><span class=p>)</span> <span class=p>([]</span><span class=kt>byte</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>timestamp</span> <span class=o>:=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;%v&#34;</span><span class=p>,</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Time</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=nx>f</span><span class=p>.</span><span class=nx>TimestampFormat</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=p>[]</span><span class=nb>byte</span><span class=p>(</span><span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;[%s] [%s] %s\n&#34;</span><span class=p>,</span> <span class=nx>f</span><span class=p>.</span><span class=nx>LevelDesc</span><span class=p>[</span><span class=nx>entry</span><span class=p>.</span><span class=nx>Level</span><span class=p>],</span> <span class=nx>timestamp</span><span class=p>,</span> <span class=nx>entry</span><span class=p>.</span><span class=nx>Message</span><span class=p>)),</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>다음으로 file을 생성하는 Hook 인터페이스를 구현한다</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>type</span> <span class=nx>FileHook</span> <span class=kd>struct</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>Formatter</span> <span class=nx>logrus</span><span class=p>.</span><span class=nx>Formatter</span>
</span></span><span class=line><span class=cl>	<span class=nx>Level</span>     <span class=p>[]</span><span class=nx>logrus</span><span class=p>.</span><span class=nx>Level</span>
</span></span><span class=line><span class=cl>	<span class=nx>Writer</span>    <span class=nx>io</span><span class=p>.</span><span class=nx>Writer</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=nf>NewFileHook</span><span class=p>()</span> <span class=nx>log</span><span class=p>.</span><span class=nx>Hook</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>file</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>os</span><span class=p>.</span><span class=nf>OpenFile</span><span class=p>(</span><span class=s>&#34;test.log&#34;</span><span class=p>,</span> <span class=nx>os</span><span class=p>.</span><span class=nx>O_CREATE</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_WRONLY</span><span class=p>|</span><span class=nx>os</span><span class=p>.</span><span class=nx>O_APPEND</span><span class=p>,</span> <span class=mo>0755</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nb>panic</span><span class=p>(</span><span class=nx>err</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=o>&amp;</span><span class=nx>FileHook</span><span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>Formatter</span><span class=p>:</span> <span class=nf>NewPlainFormatter</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>		<span class=nx>Level</span><span class=p>:</span> <span class=p>[]</span><span class=nx>log</span><span class=p>.</span><span class=nx>Level</span><span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=nx>log</span><span class=p>.</span><span class=nx>InfoLevel</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=p>},</span>
</span></span><span class=line><span class=cl>		<span class=nx>Writer</span><span class=p>:</span> <span class=nx>file</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>FileHook</span><span class=p>)</span> <span class=nf>Fire</span><span class=p>(</span><span class=nx>entry</span> <span class=o>*</span><span class=nx>log</span><span class=p>.</span><span class=nx>Entry</span><span class=p>)</span> <span class=kt>error</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>bytes</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Formatter</span><span class=p>.</span><span class=nf>Format</span><span class=p>(</span><span class=nx>entry</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=nx>h</span><span class=p>.</span><span class=nx>Writer</span><span class=p>.</span><span class=nf>Write</span><span class=p>(</span><span class=nx>bytes</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>h</span> <span class=o>*</span><span class=nx>FileHook</span><span class=p>)</span> <span class=nf>Levels</span><span class=p>()</span> <span class=p>[]</span><span class=nx>logrus</span><span class=p>.</span><span class=nx>Level</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>h</span><span class=p>.</span><span class=nx>Level</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>중요한 부분은 FileHook 구조체에 별도의 <code>Formatter</code>와 <code>Writer</code>를 설정하는것이다.</p><p>built-in formatter인 <code>TextFormatter</code>를 사용하지 않는 이유는 color code값을 제거하기 위해서다.</p><p>위 설정을 모두 추가한 후, 실제 사용부분에서 <code>log.AddHook(NewFileHook)</code> 만 추가해주면 완성이다.</p><p>실제 쓰여진 파일로그를 보면, <code>WithFields</code>를 사용한 로그는 적용되지 않는데, 그 부분은 PlainFormatter의 interface method인 <code>Format()</code>에서 별도로 처리해야 한다.</p><hr><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><ul><li><a href=https://github.com/sirupsen/logrus/issues/784>https://github.com/sirupsen/logrus/issues/784</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://ralpioxxcs.github.io/tags/golang/>golang</a></li></ul><nav class=paginav><a class=prev href=https://ralpioxxcs.github.io/post/etc/cross_compilation_arm/><span class=title>« Prev</span><br><span>aarch64 크로스 컴파일 환경 구성하기</span></a>
<a class=next href=https://ralpioxxcs.github.io/post/etc/camera_calibration_2/><span class=title>Next »</span><br><span>카메라 캘리브레이션 - 좌표변환</span></a></nav><div class=share-buttons><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on twitter" href="https://twitter.com/intent/tweet/?text=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85&url=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f&hashtags=golang"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM195.519 424.544c135.939.0 210.268-112.643 210.268-210.268.0-3.218.0-6.437-.153-9.502 14.406-10.421 26.973-23.448 36.935-38.314-13.18 5.824-27.433 9.809-42.452 11.648 15.326-9.196 26.973-23.602 32.49-40.92-14.252 8.429-30.038 14.56-46.896 17.931-13.487-14.406-32.644-23.295-53.946-23.295-40.767.0-73.87 33.104-73.87 73.87.0 5.824.613 11.494 1.992 16.858-61.456-3.065-115.862-32.49-152.337-77.241-6.284 10.881-9.962 23.601-9.962 37.088.0 25.594 13.027 48.276 32.95 61.456-12.107-.307-23.448-3.678-33.41-9.196v.92c0 35.862 25.441 65.594 59.311 72.49-6.13 1.686-12.72 2.606-19.464 2.606-4.751.0-9.348-.46-13.946-1.38 9.349 29.426 36.628 50.728 68.965 51.341-25.287 19.771-57.164 31.571-91.8 31.571-5.977.0-11.801-.306-17.625-1.073 32.337 21.15 71.264 33.41 112.95 33.41z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f&title=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85&summary=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85&source=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f&title=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on whatsapp" href="https://api.whatsapp.com/send?text=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85%20-%20https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f"><svg viewBox="0 0 512 512"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a><a target=_blank rel="noopener noreferrer" aria-label="share Golang Logrus Hook을 이용한 mutisink 로깅 on telegram" href="https://telegram.me/share/url?text=Golang%20Logrus%20Hook%ec%9d%84%20%ec%9d%b4%ec%9a%a9%ed%95%9c%20mutisink%20%eb%a1%9c%ea%b9%85&url=https%3a%2f%2fralpioxxcs.github.io%2fpost%2fetc%2flogging%2f"><svg viewBox="2 2 28 28"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></div></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://ralpioxxcs.github.io/>Devlog</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script src=/js/prism.js></script>
<script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>