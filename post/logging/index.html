<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>Golang Logrus Hookì„ ì´ìš©í•œ mutisink ë¡œê¹… :: My Devlog â€” ê¸°ë¡ &amp; ê³µë¶€ìš© ê°œë°œ ë¸”ë¡œê·¸</title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="Logrus? golangì—ì„œ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ logging íŒ¨í‚¤ì§€ì¸ logrusëŠ” stdout, stderrë“± ë‹¤ì–‘í•œ output ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•œ formatterë“± êµ¬ì¡°í™”ëœ ë¡œê¹…ì„ ì§€ì›í•œë‹¤.
êµ¬ì¡°í™”ëœ(structured) ë¡œê¹…? ë¡œê·¸ë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ì˜ ì—°ì†ì´ ì•„ë‹Œ íŠ¹ì • ë°ì´í„° ì„¸íŠ¸(ë‚ ì§œ, ì‚¬ìš©ì, ê°ì¢… í•„ë“œ)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ íŠ¹ì •í•œ ë©”ì‹œì§€ í¬ë§·ì„ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì´ë‹¤.
ê¸°ë³¸ ì‚¬ìš©ë²• ê°„ë‹¨í•˜ê²Œ ì½˜ì†”ì°½ì— ë¡œê·¸ë¥¼ ì°ëŠ” ì˜ˆì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤
package main import ( &amp;#34;os&amp;#34; &amp;#34;time&amp;#34; log &amp;#34;github.com/sirupsen/logrus&amp;#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&amp;amp;log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&amp;#34;Info message&amp;#34;) log."/>
<meta name="keywords" content=""/>
<meta name="robots" content="noodp"/>
<link rel="canonical" href="https://ralpioxxcs.github.io/post/logging/" />








<link rel="stylesheet" href="https://ralpioxxcs.github.io/css/style.min.css">






<link rel="stylesheet" href="https://ralpioxxcs.github.io/css/prism_coy2.css" id="light">    
<link rel="stylesheet" href="https://ralpioxxcs.github.io/css/dracula-prism-old.css" id="dark">    


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://ralpioxxcs.github.io/img/apple-touch-icon-144-precomposed.png">
<link rel="shortcut icon" href="https://ralpioxxcs.github.io/favicon.png">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Golang Logrus Hookì„ ì´ìš©í•œ mutisink ë¡œê¹…"/>
<meta name="twitter:description" content="Logrus? golangì—ì„œ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ logging íŒ¨í‚¤ì§€ì¸ logrusëŠ” stdout, stderrë“± ë‹¤ì–‘í•œ output ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•œ formatterë“± êµ¬ì¡°í™”ëœ ë¡œê¹…ì„ ì§€ì›í•œë‹¤.
êµ¬ì¡°í™”ëœ(structured) ë¡œê¹…? ë¡œê·¸ë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ì˜ ì—°ì†ì´ ì•„ë‹Œ íŠ¹ì • ë°ì´í„° ì„¸íŠ¸(ë‚ ì§œ, ì‚¬ìš©ì, ê°ì¢… í•„ë“œ)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ íŠ¹ì •í•œ ë©”ì‹œì§€ í¬ë§·ì„ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì´ë‹¤.
ê¸°ë³¸ ì‚¬ìš©ë²• ê°„ë‹¨í•˜ê²Œ ì½˜ì†”ì°½ì— ë¡œê·¸ë¥¼ ì°ëŠ” ì˜ˆì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤
package main import ( &#34;os&#34; &#34;time&#34; log &#34;github.com/sirupsen/logrus&#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&amp;log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&#34;Info message&#34;) log."/>



<meta property="og:title" content="Golang Logrus Hookì„ ì´ìš©í•œ mutisink ë¡œê¹…" />
<meta property="og:description" content="Logrus? golangì—ì„œ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ logging íŒ¨í‚¤ì§€ì¸ logrusëŠ” stdout, stderrë“± ë‹¤ì–‘í•œ output ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•œ formatterë“± êµ¬ì¡°í™”ëœ ë¡œê¹…ì„ ì§€ì›í•œë‹¤.
êµ¬ì¡°í™”ëœ(structured) ë¡œê¹…? ë¡œê·¸ë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ì˜ ì—°ì†ì´ ì•„ë‹Œ íŠ¹ì • ë°ì´í„° ì„¸íŠ¸(ë‚ ì§œ, ì‚¬ìš©ì, ê°ì¢… í•„ë“œ)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ íŠ¹ì •í•œ ë©”ì‹œì§€ í¬ë§·ì„ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì´ë‹¤.
ê¸°ë³¸ ì‚¬ìš©ë²• ê°„ë‹¨í•˜ê²Œ ì½˜ì†”ì°½ì— ë¡œê·¸ë¥¼ ì°ëŠ” ì˜ˆì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤
package main import ( &#34;os&#34; &#34;time&#34; log &#34;github.com/sirupsen/logrus&#34; ) func main() { log.SetOutput(os.Stdout) log.SetFormatter(&amp;log.TextFormatter{ FullTimestamp: true, TimestampFormat: time.RFC822, }) log.SetLevel(log.InfoLevel) log.Info(&#34;Info message&#34;) log." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ralpioxxcs.github.io/post/logging/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-07T22:36:04+09:00" />
<meta property="article:modified_time" content="2022-06-07T22:36:04+09:00" /><meta property="og:site_name" content="My Devlog" />








  </head>
  <body class="dark-theme">
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>

</span>
    <span class="logo__text">My Devlog</span>
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/about">About</a></li>
        
      
        
          <li><a href="/post">Post</a></li>
        
      
      
        <ul class="menu__sub-inner">
          <li class="menu__sub-inner-more-trigger">
            Show more
            <span class="menu__sub-inner-more-trigger-icon"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>

</span>
          </li>

          <ul class="menu__sub-inner-more hidden">
            
              
                <li><a href="/cs">Computer Science</a></li>
              
            
              
                <li><a href="/ps">Problem Solving</a></li>
              
            
              
                <li><a href="/til">Today I Learned</a></li>
              
            
          </ul>
        </ul>
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/about">About</a></li>
      
    
      
        <li><a href="/post">Post</a></li>
      
    
      
        <li><a href="/cs">Computer Science</a></li>
      
    
      
        <li><a href="/ps">Problem Solving</a></li>
      
    
      
        <li><a href="/til">Today I Learned</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none"/>
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        
  
  

  <div class="post">
    <h1 class="post-title"><a href="https://ralpioxxcs.github.io/post/logging/">Golang Logrus Hookì„ ì´ìš©í•œ mutisink ë¡œê¹…</a></h1>
    <div class="post-meta">
      
        <span class="post-date">
          2022-06-07
        </span>

        
          
            



          
        
      

      
      
        <span class="post-read-time">â€” 4 min read</span>
      
    </div>

    
      <span class="post-tags">
        
          #<a href="https://ralpioxxcs.github.io/tags/golang/">golang</a>&nbsp;
        
      </span>
    

    

    <div class="post-content">
      
      <h2 id="logrus">Logrus?</h2>
<p>golangì—ì„œ ì‚¬ìš©í•˜ëŠ” ëŒ€í‘œì ì¸ logging íŒ¨í‚¤ì§€ì¸ <a href="https://github.com/sirupsen/logrus">logrus</a>ëŠ” <code>stdout</code>, <code>stderr</code>ë“± ë‹¤ì–‘í•œ output ë° ì»¤ìŠ¤í„°ë§ˆì´ì§•ì´ ê°€ëŠ¥í•œ formatterë“± êµ¬ì¡°í™”ëœ ë¡œê¹…ì„ ì§€ì›í•œë‹¤.</p>
<h3 id="êµ¬ì¡°í™”ëœstructured-ë¡œê¹…">êµ¬ì¡°í™”ëœ(structured) ë¡œê¹…?</h3>
<p>ë¡œê·¸ë¥¼ ë‹¨ìˆœí•œ í…ìŠ¤íŠ¸ì˜ ì—°ì†ì´ ì•„ë‹Œ íŠ¹ì • ë°ì´í„° ì„¸íŠ¸(ë‚ ì§œ, ì‚¬ìš©ì, ê°ì¢… í•„ë“œ)ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ íŠ¹ì •í•œ ë©”ì‹œì§€ í¬ë§·ì„ êµ¬í˜„í•˜ëŠ” ë°©ì‹ì´ë‹¤.</p>
<h2 id="ê¸°ë³¸-ì‚¬ìš©ë²•">ê¸°ë³¸ ì‚¬ìš©ë²•</h2>
<p>ê°„ë‹¨í•˜ê²Œ ì½˜ì†”ì°½ì— ë¡œê·¸ë¥¼ ì°ëŠ” ì˜ˆì œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
	<span style="color:#e6db74">&#34;os&#34;</span>
	<span style="color:#e6db74">&#34;time&#34;</span>

	<span style="color:#a6e22e">log</span> <span style="color:#e6db74">&#34;github.com/sirupsen/logrus&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">SetOutput</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>)

	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">SetFormatter</span>(<span style="color:#f92672">&amp;</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">TextFormatter</span>{
		<span style="color:#a6e22e">FullTimestamp</span>:   <span style="color:#66d9ef">true</span>,
		<span style="color:#a6e22e">TimestampFormat</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">RFC822</span>,
	})

	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">SetLevel</span>(<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">InfoLevel</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Info message&#34;</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">WithFields</span>(<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Fields</span>{
		<span style="color:#e6db74">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Neymar&#34;</span>,
		<span style="color:#e6db74">&#34;age&#34;</span>:  <span style="color:#ae81ff">32</span>,
		<span style="color:#e6db74">&#34;club&#34;</span>: <span style="color:#e6db74">&#34;PSG&#34;</span>,
	}).<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Info message with fields&#34;</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debug</span>(<span style="color:#e6db74">&#34;Debug message&#34;</span>)

	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">SetLevel</span>(<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">DebugLevel</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Info</span>(<span style="color:#e6db74">&#34;Info message&#34;</span>)
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Debug</span>(<span style="color:#e6db74">&#34;Debug message&#34;</span>)
}
<span style="color:#f92672">import</span>
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">INFO[07 Jun 22 23:08 KST] Info message     
INFO[07 Jun 22 23:54 KST] Info message with fields                      age=32 club=PSG name=Neymar                            
INFO[07 Jun 22 23:08 KST] Info message                                 
DEBU[07 Jun 22 23:08 KST] Debug message  
</code></pre></div><p>ì´ì™¸ì— ë‹¤ì–‘í•œ ì‚¬ìš©ë°©ë²•ì— ëŒ€í•´ì„œëŠ” logrus <a href="https://github.com/sirupsen/logrus">ê³µì‹ë ˆí¬</a>ì—ì„œ í™•ì¸í•˜ë„ë¡ í•˜ì</p>
<hr>
<h2 id="multisink-ë¡œê¹…">Multisink ë¡œê¹…</h2>
<p>ê°œë°œì„ í•˜ë‹¤ë³´ë©´ ë‹¨ìˆœíˆ ì½˜ì†”ì°½ë¿ë§Œ ì•„ë‹ˆë¼ íŒŒì¼ì— ë¡œê·¸ë¥¼ ë‚¨ê²¨ì•¼ í•  ê²½ìš°ê°€ ìˆë‹¤. ë‹¹ì—°í•˜ê²Œë„ logrus íŒ¨í‚¤ì§€ì—ì„œëŠ” <code>io.Writer</code>ë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ëŠ” <code>logrus.SetOutput</code>ë¥¼ ì‚¬ìš©í•˜ì—¬ ì½˜ì†”, íŒŒì¼ ë‘˜ ë‹¤ ë™ì‹œì— ë¡œê¹…ì„ í•  ìˆ˜ ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">OpenFile</span>(<span style="color:#e6db74">&#34;test.log&#34;</span>, <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_CREATE</span>|<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_WRONLY</span>|<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_APPEND</span>, <span style="color:#ae81ff">0755</span>)
<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
	panic(<span style="color:#a6e22e">err</span>)
}
<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">SetOutput</span>(<span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">MultiWriter</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stdout</span>, <span style="color:#a6e22e">file</span>))
</code></pre></div><p>ìœ„ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê²Œ ë˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¶œë ¥ê³¼ ë¡œê·¸íŒŒì¼ì„ ë³¼ìˆ˜ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">time=&#34;07 Jun 22 23:21 KST&#34; level=info msg=&#34;Info message&#34;
time=&#34;07 Jun 22 23:21 KST&#34; level=info msg=&#34;Info message&#34;
time=&#34;07 Jun 22 23:21 KST&#34; level=debug msg=&#34;Debug message&#34;
</code></pre></div><h3 id="ë¡œê¹…-í˜•ì‹ì´-ë°”ë€-ì´ìœ ">ë¡œê¹… í˜•ì‹ì´ ë°”ë€ ì´ìœ </h3>
<p>ë‹¨ìˆœíˆ outputì„ ë°”ê¿”ì£¼ê¸°ë§Œ í–ˆì„ë¿ì¸ë° ë¡œê¹… í¬ë§·ì´ ë°”ë€Œì—ˆë‹¤. ê·¸ ì´ìœ ê°€ ë„ˆë¬´ ê¶ê¸ˆí•´ì„œ íŒ¨í‚¤ì§€ ë‚´ë¶€ ì½”ë“œë¥¼ ì‚´í´ë³´ì•˜ë‹¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">entry</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">Entry</span>) <span style="color:#a6e22e">write</span>() {
	<span style="color:#a6e22e">serialized</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">Formatter</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">entry</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">&#34;Failed to obtain reader, %v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
		<span style="color:#66d9ef">return</span>
	}
	<span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Lock</span>()
	<span style="color:#66d9ef">defer</span> <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">mu</span>.<span style="color:#a6e22e">Unlock</span>()
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">_</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Logger</span>.<span style="color:#a6e22e">Out</span>.<span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">serialized</span>); <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Fprintf</span>(<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">Stderr</span>, <span style="color:#e6db74">&#34;Failed to write to log, %v\n&#34;</span>, <span style="color:#a6e22e">err</span>)
	}
}
</code></pre></div><p>logrus ë‚´ë¶€ì—ì„œ ì‹¤ì§ˆì ìœ¼ë¡œ ë¡œê¹…ì„ í•˜ëŠ” ë¶€ë¶„ì„ ë´¤ë”ë‹ˆ formattingëœ byte sliceë¥¼ ë°›ì•„ì„œ loggerì— ë“±ë¡ëœ <code>io.Writer</code>ì„ í†µí•´ <code>write</code>ë¥¼ í•˜ëŠ”ë¶€ë¶„ì„ ë³¼ìˆ˜ ìˆì—ˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go">	<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">terminalInitOnce</span>.<span style="color:#a6e22e">Do</span>(<span style="color:#66d9ef">func</span>() { <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">init</span>(<span style="color:#a6e22e">entry</span>) })

	<span style="color:#a6e22e">timestampFormat</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">TimestampFormat</span>
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">timestampFormat</span> <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;&#34;</span> {
		<span style="color:#a6e22e">timestampFormat</span> = <span style="color:#a6e22e">defaultTimestampFormat</span>
	}
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">isColored</span>() {
		<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">printColored</span>(<span style="color:#a6e22e">b</span>, <span style="color:#a6e22e">entry</span>, <span style="color:#a6e22e">keys</span>, <span style="color:#a6e22e">data</span>, <span style="color:#a6e22e">timestampFormat</span>)
	} <span style="color:#66d9ef">else</span> {
    <span style="color:#75715e">// ...
</span></code></pre></div><p>ì¶œë ¥ í˜•ì‹ì´ ë°”ë€ ì´ìœ ê°€ ëœ í•µì‹¬ ë¶€ë¶„ì´ë‹¤. logrusë‚´ë¶€ì—ì„œ ê° formatterì— ë§ê²Œ í˜•ì‹ì„ ë³€í™˜ì‹œí‚¤ëŠ”ë° ê¸°ë³¸ TextFormatterì˜ ê²½ìš°, <code>isTerminal</code>ì´ë¼ëŠ” ë³€ìˆ˜ë¡œ í„°ë¯¸ë„ ì—¬ë¶€ë¥¼ íŒë‹¨í•œë‹¤. <code>f.isColored</code> ì˜ ì¡°ê±´ì— ë§ìœ¼ë©´ ì›í–ˆë˜ ë¡œê¹… í¬ë§·ì„ ì¶œë ¥í•˜ê²Œ ë˜ì–´ìˆë‹¤.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#a6e22e">isColored</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">ForceColors</span> <span style="color:#f92672">||</span> (<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">isTerminal</span> <span style="color:#f92672">&amp;&amp;</span> (<span style="color:#a6e22e">runtime</span>.<span style="color:#a6e22e">GOOS</span> <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;windows&#34;</span>))
</code></pre></div><p><code>isColored</code>ì˜ ì¡°ê±´ì€ ìœ„ì™€ ê°™ë‹¤. ë”°ë¼ì„œ Formatterì˜ ì˜µì…˜ì¤‘ í•˜ë‚˜ì¸ <code>ForceColors</code>ë¥¼ trueë¡œ ì„¤ì •í•´ì£¼ë©´ ì´ ë¬¸ì œëŠ” í•´ê²°ëœë‹¤.</p>
<p>ì•„ë˜ì—ì„œ ì„œìˆ í•  ë‚´ìš©ì´ì§€ë§Œ, í„°ë¯¸ë„ ì¶œë ¥ì´ ì•„ë‹ê²½ìš° color codeê°’ì´ ë¡œê·¸íŒŒì¼ì— ë‚¨ê²Œë˜ì–´ ì§€ì €ë¶„í•´ì§€ë‹ˆê¹Œ ìœ„ì™€ ê°™ì€ ì²˜ë¦¬ë¥¼ í•œ ê²ƒê°™ë‹¤.</p>
<h3 id="forcecolor-ì˜µì…˜ì˜-ë¬¸ì œì ">ForceColor ì˜µì…˜ì˜ ë¬¸ì œì </h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-text" data-lang="text">[36mINFO[0m[08 Jun 22 00:35 KST] Info message                                 
[36mINFO[0m[08 Jun 22 00:35 KST] Info message with fields                      [36mage[0m=32 [36mclub[0m=PSG [36mname[0m=Neymar
[36mINFO[0m[08 Jun 22 00:35 KST] Info message                                 
[37mDEBU[0m[08 Jun 22 00:35 KST] Debug message                                
</code></pre></div><p><code>ForceColors</code>ì˜µì…˜ì„ ì£¼ì–´ ê°•ì œë¡œ ìƒ‰ìƒì„ ì£¼ê³  ë¡œê·¸íŒŒì¼ì„ ë³´ë©´ ìœ„ì™€ê°™ì´ ì½˜ì†”ì—ì„œ ìƒ‰ìƒì„ ì¶œë ¥í•´ì£¼ê¸°ìœ„í•œ color codeê°’ì´ ê·¸ëŒ€ë¡œ ì í˜€ìˆë‹¤.</p>
<p>ë¡œê¹… ìì²´ì—ëŠ” ë¬¸ì œê°€ ì—†ì§€ë§Œ íŒŒì¼ì„ ì—´ì–´ì„œ ë´¤ì„ë•Œ ë³´ê¸°ë„ í˜ë“¤ê³  ì•„ë¬´ë˜ë„ ë­”ê°€ ì°ì°í•˜ë‹¤&hellip; ê·¸ë ‡ë‹¤ê³  <code>DisableColors</code>ê°’ì„ <strong>false</strong>ë¡œ ì£¼ì–´ ìœ„ color codeê°’ì„ ì—†ì• ìë‹ˆ ì½˜ì†”ì°½ì—ì„œ ìƒ‰ìƒ highlightê°€ ë˜ì§€ ì•ŠëŠ”ë‹¤.</p>
<p>ì‚¬ì‹¤ ë¡œê·¸íŒŒì¼ì„ ì½ì„ë•Œ <code>grep</code> ìœ¼ë¡œ level keywordë¥¼ highlightë¥¼ í•˜ëŠ” ë“±ì˜ íŠ¹ì • í‚¤ì›Œë“œë¥¼ <strong>highlight</strong>í•˜ëŠ” ë°©ë²•ì€ ì—¬ëŸ¬ê°€ì§€ê°€ ìˆë‹¤.</p>
<p>ê·¸ë˜ë„ ì´ë ‡ê²Œ ë§ˆë¬´ë¦¬í•˜ë©´ ì•„ì‰¬ìš¸ ê²ƒ ê°™ì•„ì„œ</p>
<ul>
<li>ê°™ì€ ë¡œê¹… í¬ë§·ì„ ì‚¬ìš©</li>
<li>ì½˜ì†”ì—ì„œëŠ” highlightë¥¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©</li>
<li>íŒŒì¼ ë¡œê¹…ì‹œì—ëŠ” color codeê°’ì„ ì œê±°</li>
</ul>
<p>ìœ„ë¥¼ ëª¨ë‘ ë§Œì¡±í•˜ëŠ” ë°©ë²•ì€ ì—†ì„ê¹Œ í•´ì„œ ì—´ì‹¬íˆ êµ¬ê¸€ë§ì„ í•´ë³´ë‹¤ê°€. ë¹„ìŠ·í•œ ë¬¸ì œë¡œ <a href="https://github.com/sirupsen/logrus/issues/784">issue</a>ê°€ ì˜¬ë¼ì˜¨ê±¸ ë³´ì•˜ë‹¤.</p>
<p>ë‹µë³€ì„ ìš”ì•½í•˜ë©´ <code>SetOutput(os.Stdout)</code>ì€ ê·¸ëŒ€ë¡œ ì ìš©í•´ coloringì„ í•˜ê³ , ë³„ë„ì˜ formatterë¥¼ ê°–ëŠ” Hookì„ ì¶”ê°€í•˜ëŠ” ë°©ë²•ìœ¼ë¡œ ë¬¸ì œë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì„ ë§í•˜ê³  ìˆë‹¤.</p>
<h2 id="file-hooking">File Hooking</h2>
<p>logrusëŠ” <a href="https://github.com/sirupsen/logrus#hooks"><code>hook</code></a>ê¸°ëŠ¥ì„ ì œê³µí•˜ëŠ”ë° hookì„ ì´ìš©í•´ ì§€ì •ëœ ê³³ì— í•œë²ˆì— ë¡œê·¸ë¥¼ ë‚¨ê¸¸ ìˆ˜ ìˆë‹¤.</p>
<p>ìš°ì„  color codeê°€ ì—†ëŠ” í˜•íƒœì˜ custom formatter ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">PlainFormatter</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">TextFormatter</span>
	<span style="color:#a6e22e">TimestampFormat</span> <span style="color:#66d9ef">string</span>
	<span style="color:#a6e22e">LevelDesc</span>       []<span style="color:#66d9ef">string</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewPlainFormatter</span>() <span style="color:#f92672">*</span><span style="color:#a6e22e">PlainFormatter</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">PlainFormatter</span>{
		<span style="color:#a6e22e">TimestampFormat</span>: <span style="color:#a6e22e">time</span>.<span style="color:#a6e22e">RFC3339</span>,
		<span style="color:#a6e22e">LevelDesc</span>:       []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;PANC&#34;</span>, <span style="color:#e6db74">&#34;FATL&#34;</span>, <span style="color:#e6db74">&#34;ERRO&#34;</span>, <span style="color:#e6db74">&#34;WARN&#34;</span>, <span style="color:#e6db74">&#34;INFO&#34;</span>, <span style="color:#e6db74">&#34;DEBG&#34;</span>},
	}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">f</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">PlainFormatter</span>) <span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">entry</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Entry</span>) ([]<span style="color:#66d9ef">byte</span>, <span style="color:#66d9ef">error</span>) {
	<span style="color:#a6e22e">timestamp</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;%v&#34;</span>, <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Time</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">TimestampFormat</span>))
	<span style="color:#66d9ef">return</span> []byte(<span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Sprintf</span>(<span style="color:#e6db74">&#34;[%s] [%s] %s\n&#34;</span>, <span style="color:#a6e22e">f</span>.<span style="color:#a6e22e">LevelDesc</span>[<span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Level</span>], <span style="color:#a6e22e">timestamp</span>, <span style="color:#a6e22e">entry</span>.<span style="color:#a6e22e">Message</span>)), <span style="color:#66d9ef">nil</span>
}
</code></pre></div><p>ë‹¤ìŒìœ¼ë¡œ fileì„ ìƒì„±í•˜ëŠ” Hook ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#66d9ef">type</span> <span style="color:#a6e22e">FileHook</span> <span style="color:#66d9ef">struct</span> {
	<span style="color:#a6e22e">Formatter</span> <span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Formatter</span>
	<span style="color:#a6e22e">Level</span>     []<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Level</span>
	<span style="color:#a6e22e">Writer</span>    <span style="color:#a6e22e">io</span>.<span style="color:#a6e22e">Writer</span>
}

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">NewFileHook</span>() <span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Hook</span> {
	<span style="color:#a6e22e">file</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">OpenFile</span>(<span style="color:#e6db74">&#34;test.log&#34;</span>, <span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_CREATE</span>|<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_WRONLY</span>|<span style="color:#a6e22e">os</span>.<span style="color:#a6e22e">O_APPEND</span>, <span style="color:#ae81ff">0755</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		panic(<span style="color:#a6e22e">err</span>)
	}

	<span style="color:#66d9ef">return</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">FileHook</span>{
		<span style="color:#a6e22e">Formatter</span>: <span style="color:#a6e22e">NewPlainFormatter</span>(),
		<span style="color:#a6e22e">Level</span>: []<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Level</span>{
			<span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">InfoLevel</span>,
		},
		<span style="color:#a6e22e">Writer</span>: <span style="color:#a6e22e">file</span>,
	}
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FileHook</span>) <span style="color:#a6e22e">Fire</span>(<span style="color:#a6e22e">entry</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">log</span>.<span style="color:#a6e22e">Entry</span>) <span style="color:#66d9ef">error</span> {
	<span style="color:#a6e22e">bytes</span>, <span style="color:#a6e22e">err</span> <span style="color:#f92672">:=</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Formatter</span>.<span style="color:#a6e22e">Format</span>(<span style="color:#a6e22e">entry</span>)
	<span style="color:#66d9ef">if</span> <span style="color:#a6e22e">err</span> <span style="color:#f92672">!=</span> <span style="color:#66d9ef">nil</span> {
		<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">err</span>
	}
	<span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Writer</span>.<span style="color:#a6e22e">Write</span>(<span style="color:#a6e22e">bytes</span>)

	<span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
}

<span style="color:#66d9ef">func</span> (<span style="color:#a6e22e">h</span> <span style="color:#f92672">*</span><span style="color:#a6e22e">FileHook</span>) <span style="color:#a6e22e">Levels</span>() []<span style="color:#a6e22e">logrus</span>.<span style="color:#a6e22e">Level</span> {
	<span style="color:#66d9ef">return</span> <span style="color:#a6e22e">h</span>.<span style="color:#a6e22e">Level</span>
}
</code></pre></div><p>ì¤‘ìš”í•œ ë¶€ë¶„ì€ FileHook êµ¬ì¡°ì²´ì— ë³„ë„ì˜ <code>Formatter</code>ì™€ <code>Writer</code>ë¥¼ ì„¤ì •í•˜ëŠ”ê²ƒì´ë‹¤.</p>
<p>built-in formatterì¸ <code>TextFormatter</code>ë¥¼ ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì´ìœ ëŠ” color codeê°’ì„ ì œê±°í•˜ê¸° ìœ„í•´ì„œë‹¤.</p>
<p>ìœ„ ì„¤ì •ì„ ëª¨ë‘ ì¶”ê°€í•œ í›„, ì‹¤ì œ ì‚¬ìš©ë¶€ë¶„ì—ì„œ <code>log.AddHook(NewFileHook)</code> ë§Œ ì¶”ê°€í•´ì£¼ë©´ ì™„ì„±ì´ë‹¤.</p>
<p>ì‹¤ì œ ì“°ì—¬ì§„ íŒŒì¼ë¡œê·¸ë¥¼ ë³´ë©´, <code>WithFields</code>ë¥¼ ì‚¬ìš©í•œ ë¡œê·¸ëŠ” ì ìš©ë˜ì§€ ì•ŠëŠ”ë°, ê·¸ ë¶€ë¶„ì€ PlainFormatterì˜ interface methodì¸ <code>Format()</code>ì—ì„œ ë³„ë„ë¡œ ì²˜ë¦¬í•´ì•¼ í•œë‹¤.</p>
<hr>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="https://github.com/sirupsen/logrus/issues/784">https://github.com/sirupsen/logrus/issues/784</a></li>
</ul>

    </div>
    
    <div class="pagination">
        <div class="pagination__title">
            <span class="pagination__title-h">
                Read other posts
            </span>
            <hr />
        </div>
        <div class="pagination__buttons">
            
              <span class="button previous">
                <a href="https://ralpioxxcs.github.io/post/etc/cgo_callback/">
                  <span class="button__icon">â†</span>
                  <span class="button__text">C/C&#43;&#43; &lt;-&gt; Go ì½œë°±í•¨ìˆ˜ êµ¬í˜„í•˜ê¸°</span>
                </a>
              </span>
            
            

                
        </div>
    </div>
      

    

    
      
        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "https-ralpioxxcs-github-io" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

      
    

    </div>

      </div>

      
        <footer class="footer">
  <div class="footer__inner">
    
      <a href="/" class="logo" style="text-decoration: none;">
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367"/>
</svg>

</span>
    <span class="logo__text">My Devlog</span>
    <span class="logo__cursor_foot"></span>
  
</a>

      <div class="copyright">
         
        <span>Theme created by <a href="https://twitter.com/panr" target="_blank" rel="noopener">panr</a> & customized by <a href="https://github.com/ralpioxxcs">ralpioxxcs</a></span>
      </div>
    
  </div>
</footer>





<script src="https://ralpioxxcs.github.io/js/menu.js"></script>
<script src="https://ralpioxxcs.github.io/js/theme.js"></script>
<script src="https://ralpioxxcs.github.io/js/prism.js"></script>


      
    </div>

    
      
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-189380926-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
    
  </body>
</html>
